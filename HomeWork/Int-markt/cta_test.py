"""
Программа для проведения A/B-тестирования разных вариантов CTA
Автор: начинающий геймдев
"""
import time  # для будущих улучшений, хочу добавить таймер

# пока не использую, но планирую добавить визуализацию
# import matplotlib.pyplot as plt

# Тут будут варианты текста для кнопок
cta_options = {
    "1": "Подпишись и получи бонус!",
    "2": "Будь в курсе новостей – подпишись сейчас!",
    "3": "Оформи подписку – эксклюзивный контент внутри!"
    # хотел добавить еще вариантов, но для MVP хватит и трех
    # "4": "Только сегодня - подпишись бесплатно!",  
    # "5": "Нажми здесь для получения секретной информации!",
}

# Для учета кликов по каждому варианту
clicks = {"1": 0, "2": 0, "3": 0}  

# План на будущее - считать конверсию
# conversion_rate = {"1": 0, "2": 0, "3": 0}

# Приветствие пользователя
print("### A/B тестирование для моего проекта ###")
print("Выберите наиболее привлекательный призыв к действию:")

# Показываем варианты
for key, value in cta_options.items():
    print(f"{key}: {value}")

# Начинаем опрос
user_count = 10  # в идеале нужно больше, но для теста хватит
for i in range(user_count):
    print(f"\nПользователь {i+1}:")
    choice = input("Введите номер понравившегося варианта (1, 2 или 3): ").strip()
    
    # Проверяем ввод
    if choice in clicks:
        clicks[choice] += 1
        # print(f"DEBUG: Добавлен голос за вариант {choice}")  # отладочная информация
    else:
        print(f"Ошибка! '{choice}' - неправильный вариант. Нужно выбрать 1, 2 или 3.")
        i -= 1  # повторяем для этого пользователя

# Можно добавить небольшую задержку для эффекта
time.sleep(1)
print("\nОбработка результатов...")
time.sleep(0.5)

# находим самый популярный вариант
max_clicks = 0
popular_option = ""
for option, count in clicks.items():
    if count > max_clicks:
        max_clicks = count
        popular_option = option

# Выводим результаты
print("\nРезультаты тестирования:")
for key, value in clicks.items():
    percentage = (value / user_count) * 100  # тут ошибка, надо делить на фактическое число ответов
    print(f"{cta_options[key]} – {value} голосов ({percentage:.1f}%)")

print(f"\nСамый популярный вариант: {cta_options[popular_option]}")

# Сохраняем результаты
filename = "результаты_тестирования.txt"
with open(filename, "w", encoding="utf-8") as file:
    file.write("Результаты A/B-тестирования CTA\n")
    file.write("-------------------------------\n\n")
    for key, value in clicks.items():
        file.write(f"{cta_options[key]} – {value} голосов\n")
    file.write(f"\nСамый популярный CTA: {cta_options[popular_option]}")
    
print(f"\nРезультаты сохранены в файл '{filename}'")

# TODO: Добавить визуализацию результатов
# TODO: Исправить баг с подсчетом процентов
# TODO: Сделать веб-версию для удобного тестирования 